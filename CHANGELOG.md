# Changelog

Все заметные изменения в проекте BSL Gradual Type System документируются в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и проект придерживается [Semantic Versioning](https://semver.org/lang/ru/).

## [0.4.0] - 2024-12-XX (Phase 3.5 - ЗАВЕРШЕНА)

### Добавлено
- Парсер ZIP архивов синтакс-помощника (rebuilt.shcntx_ru.zip, rebuilt.shlang_ru.zip)
- Извлечение глобальных функций и их сигнатур (476 функций)
- Парсинг ключевых слов языка с правильной категоризацией (22 ключевых слова)
- Система TypeRef для нормализации типов с префиксами:
  - `language:` для типов языка
  - `context:` для объектов контекста
  - `metadata_ref:` для ссылок на метаданные
- Определение фасетов из имён типов (CatalogManager → Manager)
- Интеграция с FacetRegistry для динамической регистрации фасетов
- Система кеширования фасетов (FacetCache) с 30-дневной валидностью
- Интеграция с PlatformTypesResolverV2
- Визуализация с правильной иерархией языковых конструкций:
  - Общее описание встроенного языка
  - Операторы и синтаксические конструкции (11)
  - Определения (7)
  - Выражения (4)
- Генераторы HTML-визуализаций:
  - `generate_proper_hierarchy` - правильная иерархия
  - `generate_tree_hierarchy` - древовидная структура
  - `generate_enhanced_report` - расширенный отчёт с TypeRef

### Изменено
- Улучшена категоризация языковых конструкций согласно официальной документации
- Оптимизирована загрузка синтакс-помощника (полная загрузка вместо ленивой)
- Расширен PlatformTypesResolverV2 для работы с новыми типами

### Исправлено
- Правильная обработка префиксов файлов (struct_*, def_*, root_*, operator_*)
- Корректное определение категорий ключевых слов
- Нормализация типов через TypeRef

## [0.3.0] - 2024-01-12

### Добавлено
- Полный парсер языка запросов 1С с поддержкой:
  - Составных имён таблиц (Документ.ПоступлениеТоваровУслуг)
  - Временных таблиц (ПОМЕСТИТЬ/ИЗ ВТ_)
  - Пакетных запросов с анализом зависимостей
  - JOIN операций (ЛЕВОЕ/ПРАВОЕ/ПОЛНОЕ/ВНУТРЕННЕЕ СОЕДИНЕНИЕ)
  - Агрегатных функций и GROUP BY/HAVING
  - Подзапросов и UNION
  - CASE выражений и BETWEEN операторов
- Интеграция парсера запросов с системой типов
- Анализ зависимостей в пакетных запросах
- Определение оптимального порядка выполнения запросов
- Новая структура тестов с разделением на integration и fixtures
- Примеры использования в директории examples/
- Демонстрация парсера запросов (query_demo.rs)

### Изменено
- Реорганизована структура проекта:
  - Тесты перемещены в tests/integration/
  - BSL примеры в tests/fixtures/bsl/
  - Создана директория examples/ для демонстраций
- Обновлена версия проекта на 0.3.0
- Улучшена документация с актуальным статусом

### Исправлено
- Парсинг составных имён таблиц в запросах
- Конфликт ключевых слов "И" и "ИЗ" в парсере
- Поддержка символа | в начале строк запросов 1С
- Обработка комментариев // в запросах

## [0.2.0] - 2024-01-10

### Добавлено
- BSL парсер на основе nom combinators
- Генерация AST (Abstract Syntax Tree)
- Visitor pattern для обхода AST
- Граф зависимостей типов с обнаружением циклов
- Type checker с выводом типов и уровнями уверенности
- Проверка совместимости типов
- Диагностики в LSP (ошибки, предупреждения, информация)
- Контекстно-зависимое разрешение типов
- Стандартные типы BSL (Число, Строка, Булево, Дата, Массив, Структура и др.)

### Изменено
- Улучшено автодополнение с учётом контекста
- Оптимизирована загрузка конфигурации для больших проектов
- Расширена фасетная система для поддержки всех типов объектов

### Исправлено
- Производительность LSP сервера при работе с большими файлами
- Корректное определение фасетов в разных контекстах
- Циклические зависимости в графе типов

## [0.1.0] - 2024-01-05 - MVP

### Добавлено
- Базовая система типов с уровнями уверенности (Known, Inferred, Unknown)
- TypeResolution - центральная абстракция для разрешения типов
- Полная фасетная система (Manager, Object, Reference, Constructor, Metadata)
- Runtime контракты для динамической проверки типов
- Парсер Configuration.xml с поддержкой табличных частей
- Загрузка платформенных типов (хардкод с TODO для будущей замены)
- LSP сервер с базовыми возможностями:
  - Hover для показа информации о типах
  - Completion для автодополнения
- Автодополнение для Справочники.*, Документы.* и других типов
- CLI инструменты:
  - bsl-analyzer для анализа BSL файлов
  - build-index для построения индекса типов
  - lsp-server для запуска LSP сервера
- Кеширование TypeResolution через LRU cache
- Поддержка конфигураций с 1000+ объектами

### Архитектура
- Слоистая архитектура с чёткими границами:
  - Core Layer: типы, фасеты, контракты
  - Adapter Layer: парсеры внешних данных
  - Resolution Layer: разрешение типов
  - Application Layer: LSP, CLI инструменты
- Эволюционный подход к развитию системы
- Модульность через traits для расширяемости

## [Не выпущено]

### В работе
- Извлечение глобальных объектов из синтакс-помощника
- Парсинг системных перечислений
- Полная интеграция новых типов в LSP для автодополнения

### Планируется (Phase 4 - Расширенный анализ)
- Flow-sensitive анализ типов
- Межпроцедурный анализ
- Type narrowing в условных конструкциях
- Обнаружение мёртвого кода
- Оптимизация запросов

### Планируется (Phase 5)
- Парсер документации платформы (ITS, HTML)
- Замена хардкод типов на реальные из документации
- Индексация метаданных конфигурации
- Межмодульное отслеживание типов

### Планируется (Phase 6)
- Инкрементальный анализ
- Параллельная проверка типов
- ML-based предсказания типов
- Инструменты профилирования

## Легенда

- **Добавлено** - новая функциональность
- **Изменено** - изменения в существующей функциональности
- **Устарело** - функциональность, которая будет удалена
- **Удалено** - удалённая функциональность
- **Исправлено** - исправленные баги
- **Безопасность** - исправления уязвимостей

[0.4.0]: https://github.com/yourusername/bsl-gradual-types/compare/v0.3.0...v0.4.0
[0.3.0]: https://github.com/yourusername/bsl-gradual-types/compare/v0.2.0...v0.3.0
[0.2.0]: https://github.com/yourusername/bsl-gradual-types/compare/v0.1.0...v0.2.0
[0.1.0]: https://github.com/yourusername/bsl-gradual-types/releases/tag/v0.1.0