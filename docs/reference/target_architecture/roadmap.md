# Дорожная карта внедрения целевой архитектуры

Этот документ описывает дорожную карту миграции с устаревшей архитектуры на целевую, а также план реализации нового функционала. Фокус — на безопасной поэтапной интеграции с возможностью отката.

## Этап 1: Миграция данных и парсинга (1–2 недели)

**Цель:** Создать основу для работы с типами данных, реализовав загрузку и хранение информации о типах.

- [ ] **Реализация загрузчика данных для `TypeRepository`:**
  - Создать адаптер для загрузки данных из синтакс-помощника в `RawTypeData`.
  - Реализовать загрузку конфигурации из XML-файлов (минимальный набор).
- [ ] **Интеграция `tree-sitter` для парсинга:**
  - Настроить парсер `tree-sitter` для анализа исходного кода BSL.
  - Интегрировать парсер с `TypeRepository` для извлечения информации о типах.
- [ ] **Адаптация структур данных:**
  - Обеспечить преобразование "сырых" данных в доменные модели.
  - Реализовать индексы для быстрого поиска по имени, категориям и фасетам.
- [ ] **Метрики:**
  - Добавить базовые метрики для отслеживания количества загруженных типов.

## Этап 2: Перенос и расширение доменной логики (2–3 недели)

**Цель:** Реализовать ядро системы — логику разрешения и проверки типов.

- [ ] **Миграция логики разрешения типов:**
  - Перенести существующую логику из `src/core` в новый `TypeResolutionService`.
  - Реализовать резолверы для платформенных, встроенных и пользовательских типов.
- [ ] **Реализация проверки типов:**
  - Создать `TypeCheckerService` для проверки соответствия типов в выражениях и присваиваниях.
- [ ] **Поддержка контрактов и аннотаций:**
  - Реализовать парсинг и учет аннотаций типов в комментариях.
  - (Опционально) Добавить поддержку формальных контрактов.
- [ ] **Кеширование и трассировка:**
  - Внедрить кеширование для ускорения повторных разрешений типов.
  - Добавить механизм трассировки для отладки процесса разрешения.

## Этап 3: Построение интерфейсов и конечных точек (1–2 недели)

**Цель:** Предоставить доступ к новой системе типов через внешние интерфейсы.

- [ ] **Реализация LSP-интерфейса:**
  - Создать `LspTypeService` для интеграции с Language Server Protocol.
  - Реализовать обработчики для `hover` и `completion`, используя новый сервис.
  - Обеспечить минимальные задержки (<20 мс) для базовых вызовов.
- [ ] **Создание CLI-интерфейса:**
  - Разработать `AnalysisTypeService` для анализа проектов из командной строки.
  - Реализовать команды для вывода информации о типах, поиска и анализа.
- [ ] **(Опционально) Web-API:**
  - Создать `WebTypeService` для предоставления "богатых" данных (иерархия, поиск).
  - Реализовать REST/GraphQL эндпоинты.

## Этап 4: Интеграция, тестирование и удаление устаревшего кода (2 недели)

**Цель:** Завершить миграцию, обеспечив стабильность и удалив старый код.

- [ ] **Обновление точки входа:**
  - Переключить основной исполняемый файл на использование сервисов из новой архитектуры.
  - Использовать фича-флаги для плавного переключения.
- [ ] **Написание интеграционных тестов:**
  - Покрыть ключевые сценарии использования интеграционными тестами.
  - Настроить CI для автоматического запуска тестов.
- [ ] **Удаление устаревшего кода:**
  - После полного перехода и стабилизации удалить `src/core`.
  - Обновить документацию и примеры.
- [ ] **Метрики и мониторинг:**
  - Настроить сквозные метрики производительности и работоспособности (health-checks).

## Примечания
- Сроки являются ориентировочными.
- Все переключения должны производиться через фича-флаги или конфигурацию, чтобы не нарушать работу существующих API.
