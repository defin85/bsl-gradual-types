# План миграции к целевой архитектуре

Цель — включать новые слои постепенно, сохранив работоспособность текущих бинарей и API.

## Стратегия
1) Strangler‑pattern: новые сервисы живут рядом и перехватывают вызовы по мере готовности
2) Фича‑флаги/конфигурация: переключение на новый путь без перекомпоновки кода
3) Метрики и трейсинг: сравнивать ответы/латентность со старой реализацией

## Переключения (по компонентам)
- LSP: `--engine=legacy|target` или переменная окружения `BSL_TYPES_ENGINE`
- Web: маршруты проксируются к новому `WebTypeService` при включении режима
- CLI: команды анализа используют `AnalysisTypeService` при флаге

## Порядок шагов
1. Завести центральную систему в `src/target/system` и инициализацию с пустыми заглушками
2. Подключить репозиторий и загрузку платформенных типов
3. Включить минимальный `TypeResolutionService` (Platform/Builtin)
4. Проксировать hover/completion LSP через новый сервис для безопасного поднабора кейсов
5. Расширять покрытие резолверов и источников, увеличивая долю трафика

## Риски и митигация
- Различия в данных: синхронизация индексов и fallback на legacy путь
- Производительность: поэтапное включение, профилирование на реальных проектах
- Совместимость: API интерфейсов неизменны, меняется только реализация
